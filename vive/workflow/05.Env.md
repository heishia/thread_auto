# Environment Variable Specification

## 0. 기본 전제

- 개발 속도와 실수를 줄이기 위해 **DEV 환경은 최대한 단순화**한다.
- **운영(PROD) 환경 변수는 GitHub Environment에서 관리**한다.
- 운영 환경 변수는 코드나 저장소에 포함하지 않는다.
- 배포 시 **코드 수정 없이 환경 변수만 주입**한다.

---

## 1. 환경 변수 관리 전략

### DEV (로컬 개발)

- 프로젝트 루트에 `.env` **단일 파일** 사용
- `.env` 파일은 gitignore 대상
- 로컬 개발자는 이 파일 하나만 관리한다

### PROD (운영)

- `.env.prod` 파일을 사용하지 않는다
- **GitHub Environments (Secrets / Variables)** 로 관리한다
- 배포 시 CI/CD 파이프라인에서 자동 주입한다

---

## 2. 파일 구성

.env            # 로컬 개발 전용 (커밋 X)
.env.example    # 환경 변수 스펙 명세 (선택, 커밋 O)

---

## 3. `.env` (DEV)

- 로컬 개발 전용
- 실제 값 포함
- gitignore 대상

APP_ENV=dev
DATABASE_URL=postgres://localhost/dev
JWT_SECRET=dev-secret
LOG_LEVEL=debug

---

## 4. `.env.example` (선택)

- 이 프로젝트가 요구하는 **환경 변수 형태 명세**
- 실제 값은 포함하지 않는다
- 신규 환경 세팅 및 AI 참고용 문서 역할

APP_ENV=
DATABASE_URL=
JWT_SECRET=
LOG_LEVEL=

---

## 5. PROD 환경 변수 관리 (GitHub Environment)

- GitHub → Settings → Environments → `prod`
- 모든 운영 환경 변수는 GitHub Environment에서 관리한다
- Secrets / Variables는 저장소에 커밋되지 않는다

### 예시 변수

- DATABASE_URL
- JWT_SECRET
- LOG_LEVEL
- 기타 운영 전용 변수

---

## 6. CI/CD에서의 사용 방식

- 배포 Job은 반드시 `environment: prod` 를 명시한다
- 해당 Environment에 등록된 변수만 접근 가능하다

jobs:
  deploy:
    environment: prod
    runs-on: ubuntu-latest
    steps:
      - name: Run API
        run: |
          docker run             -e APP_ENV=prod             -e DATABASE_URL=${{ secrets.DATABASE_URL }}             -e JWT_SECRET=${{ secrets.JWT_SECRET }}             my-api

---

## 7. 애플리케이션 설정 로딩 규칙

- 환경 변수는 **단일 설정 진입점**에서만 로드한다
- DEV / PROD 구분은 환경 변수 주입 방식으로만 처리한다
- 코드에서 env 파일 분기 로직을 두지 않는다

from pydantic import BaseSettings

class Settings(BaseSettings):
    app_env: str = "dev"
    database_url: str
    jwt_secret: str
    log_level: str = "INFO"

settings = Settings()

- DEV: `.env` 자동 로드
- PROD: GitHub Environment에서 주입
- 코드 변경 없음

---

## 8. 금지 사항

- `.env.prod` 파일 생성
- 운영 환경 변수의 저장소 커밋
- 코드 내 환경 변수 값 하드코딩
- 환경별 설정 파일 분기 로직 추가

---

## 9. 목적 요약

- DEV 환경은 빠르고 단순하게 유지한다
- PROD 환경 변수는 플랫폼(GitHub)이 책임진다
- 배포 실수 가능성을 최소화한다
- 환경 변수 관리로 인한 개발 피로도를 줄인다

---

## 최종 요약

**DEV는 `.env` 하나로 관리하고,  
PROD는 GitHub Environment를 통해 배포 시 주입한다.**
